# AI Version Log

Registro incremental obligatorio de cambios aplicados por agentes AI.

| FECHA | VERSION_ANTERIOR | VERSION_NUEVA | AGENTE | MODULOS | RESUMEN |
|---|---|---|---|---|---|
| 2026-02-13 | 1.0002 | 1.0003 | Codex | pronto-employees, pronto-client, pronto-static, pronto-api, pronto-libs, pronto-scripts | Corrección real de endpoints faltantes en runtime para clientes/empleados, validación de contenedores healthy, y consolidación de control de versión en .env/AGENTS. |
| 2026-02-13 | 1.0003 | 1.0004 | Codex | pronto-scripts | Corrección real de `rebuild`/sync estático: detección robusta del contenedor static y fix de typo `employee`->`employees` para evitar despliegues con assets desactualizados. |
| 2026-02-13 | 1.0004 | 1.0005 | Codex | pronto-static, pronto-docs, pronto-scripts | Corrección de flujo de menú cliente para IDs UUID (sin NaN), fallback robusto de placeholder de imágenes y normalización de tipado de carrito; registro y cierre formal del bug en tracker de errores. |
| 2026-02-13 | 1.0005 | 1.0006 | Codex | pronto-tests, pronto-docs, pronto-scripts/pronto-root | Alineacion del set funcional Playwright a contratos/rutas vigentes (auth CSRF, menu API data.categories, empleados/login), eliminacion de pruebas legacy fragiles y validacion final en verde (`npm run test:functionality`: 35/35). |
| 2026-02-13 | 1.0006 | 1.0007 | Codex | pronto-api, pronto-tests, pronto-docs, pronto-scripts/pronto-root | Fix CORS preflight para checkout cliente (`X-CSRFToken` permitido en `Access-Control-Allow-Headers`), rebuild de servicios y validación iterativa hasta suite funcional completa en verde (`35/35`). |
| 2026-02-13 | 1.0007 | 1.0008 | Codex | pronto-static, pronto-tests, pronto-docs, pronto-scripts/pronto-root | Corrección de loop de sesión en login employees (401 en login ya no fuerza redirect), estabilización visual del login en modo invitado y prueba de regresión E2E para asegurar que no aparezca sidebar en `/employees/login`; suite funcional completa en verde (`36/36`). |
| 2026-02-13 | 1.0008 | 1.0009 | Codex | pronto-static, pronto-employees, pronto-docs, pronto-scripts/pronto-root | Normalización visual de logins de empleados por rol (escala/layout uniforme) y corrección de ubicación de versión para mostrarla fija en viewport sin scroll. |
| 2026-02-13 | 1.0009 | 1.0010 | Codex | pronto-static, pronto-tests, pronto-scripts/pronto-root | Modularización del bundle employees: bootstrap separado, shell/components en import asíncrono, carga diferida de store de órdenes y chunking dedicado (router-vendor, pinia-vendor, employees-core, employees-store) para reducir main.js y mantener login/flujo estable. |
| 2026-02-13 | 1.0010 | 1.0011 | Codex | pronto-static, pronto-scripts/pronto-root | Fix final de login employees: eliminación del throw sintético de Sesión expirada en wrapper HTTP para preservar mensaje real del backend en login (Credenciales inválidas), rebuild de assets y reinicio de static. |
| 2026-02-13 | 1.0011 | 1.0012 | Codex | pronto-static, pronto-scripts/pronto-root | Corrección de login shell employees: reemplazo de dependencia global window.requestJSON por import tipado de core/http y omisión de fetchUser en rutas guest para eliminar errores 401/console noise al abrir login. |
| 2026-02-13 | 1.0012 | 1.0013 | Codex | pronto-libs, pronto-employees, pronto-static, pronto-tests, pronto-docs, pronto-scripts/pronto-root | Fix de login empleados por roles: `has_scope` ahora considera rol principal/jerarquía canónica, serialización UUID en JWT/JSON de auth, y ajuste de frontend para no redirigir en 403 dentro de login; validación completa con suite funcional en verde (`36/36`) y prueba dedicada de login por 5 roles (`5/5`). |
| 2026-02-13 | 1.0013 | 1.0014 | Codex | pronto-scripts, pronto-docs, pronto-scripts/pronto-root | Corrección de `validate-seed.sh`: detección robusta de contenedor employees, rutas absolutas y fail-fast real (sin falso positivo de éxito); documentación de error resuelto y apertura de incidente por desalineación modelo/esquema de `pronto_areas` que rompe seed ORM. |
| 2026-02-13 | 1.0014 | 1.0015 | Codex | pronto-employees, pronto-static, pronto-docs, pronto-scripts/pronto-root | Fix de 404 en employees para `/authorization-error` y `/favicon.ico`, y robustez de detección de login path en interceptor HTTP para evitar redirección errónea desde login; validado con Playwright y checks HTTP en 6081. |
| 2026-02-13 | 1.0015 | 1.0016 | Codex | pronto-static, pronto-employees, pronto-scripts/pronto-root | Corrección visual y de flujo en login employees: hardening del shell (Header/Sidebar/App/Dashboard), carga estática de `LoginPage` para eliminar mezcla de estado en login, compatibilidad de assets legacy en build de static y proxy server-side de `/assets/*` en employees para evitar fallos de chunks/CSS cross-origin. |
| 2026-02-13 | 1.0016 | 1.0017 | Codex | pronto-static, pronto-docs, pronto-scripts/pronto-root | Fix de placeholder en menú cliente: el fallback ya no usa la ruta de restaurante para placeholder inexistente y ahora aplica el placeholder global canónico para eliminar 404/OpaqueResponseBlocking. |
| 2026-02-13 | 1.0017 | 1.0018 | Codex | pronto-static, pronto-employees, pronto-api, pronto-scripts, pronto-docs, pronto-scripts/pronto-root | Estabilización de login employees y flujos de módulos: hardening de detección JSON en auth por rol, proxy/aliases de assets legacy, tolerancia a `vite:preloadError`, rutas explícitas para chunks legacy, y resiliencia en notificaciones waiter para evitar 500 cuando falta `pronto_waiter_calls`; migraciones/init-check ejecutados en verde. |
| 2026-02-13 | 1.0018 | 1.0019 | Codex | pronto-static, pronto-docs, pronto-scripts/pronto-root | Restricción de navegación por rol en employees: mesero limitado a Operación Mesero + Productos + Aditamientos + Mesas + Áreas; chef/cashier limitados a su módulo; guard de rutas actualizado para bloquear acceso por URL a módulos no permitidos. |
| 2026-02-13 | 1.0019 | 1.0020 | Codex | pronto-static, pronto-tests, pronto-docs, pronto-scripts/pronto-root | Endurecimiento final por scope activo: detección de contexto por ruta (`/waiter|/chef|/cashier`) + `APP_CONTEXT` + `active_scope` en App/Router para ocultar y bloquear módulos ADMIN en contexto waiter; compilación employees y pruebas Playwright (auth/orders/login flows) en verde. |
| 2026-02-13 | 1.0020 | 1.0021 | Codex | pronto-static, pronto-docs, pronto-scripts/pronto-root | Corrección visual de barra superior employees: estilos críticos del `Header` reforzados inline (altura, avatar, alineación y tipografía) y shell principal con imports estáticos para evitar render roto por carga diferida de estilos/chunks. |
| 2026-02-13 | 1.0021 | 1.0022 | Codex | pronto-static, pronto-scripts, pronto-docs, pronto-scripts/pronto-root | Fix de despliegue static: Dockerfile ahora copia `pronto-static/scripts` para incluir `ensure-employees-legacy-assets.mjs`; rebuild exitoso de `static` + `employees`, assets actualizados en runtime (`main.js?v=1.0021`), y cierre formal de incidente en error tracker. |
| 2026-02-13 | 1.0022 | 1.0023 | Codex | pronto-employees, pronto-static, pronto-scripts, pronto-docs, pronto-scripts/pronto-root | Reubicación de versión en UI empleados: eliminación del badge flotante inferior, exposición de `system_version` en `APP_CONFIG` SSR y render de versión en footer del sidebar; rebuild de `static` + `employees` y validación visual en `http://localhost:6081/waiter/dashboard`. |
| 2026-02-13 | 1.0023 | 1.0024 | Codex | pronto-tests, pronto-docs, pronto-scripts/pronto-root | Endurecimiento de pruebas de autenticación: `auth.spec.ts` y `test_login_flows.spec.ts` ahora realizan login real por POST con CSRF y credenciales seed; cualquier `401/403` de auth falla el test explícitamente, evitando falsos verdes de “ruta disponible”. |
| 2026-02-13 | 1.0024 | 1.0025 | Codex | pronto-static, pronto-docs, pronto-scripts/pronto-root | Corrección de enrutamiento API en frontend clientes: `/api/*` vuelve a resolverse por host relativo (no forzado a 6082), eliminando preflight 404 en `POST /api/call-waiter`; se documenta reapertura y cierre formal en error tracker. |
| 2026-02-13 | 1.0025 | 1.0026 | Codex | pronto-static, pronto-employees, pronto-tests, pronto-scripts/pronto-root | Estabilización de login empleados: anti-caché en HTML/CSS versionados, corrección de tabs por rol en `DashboardView` (mesero sin módulos admin), y actualización de pruebas auth para credenciales seed actuales + endpoint canónico `API_URL` en validación de `/api/employees/auth/me`. |
| 2026-02-13 | 1.0026 | 1.0027 | Codex | pronto-static, pronto-scripts/pronto-root | Eliminada compatibilidad legacy de assets en build de empleados: se removió `node scripts/ensure-employees-legacy-assets.mjs` de `build:employees` y se eliminó el archivo `scripts/ensure-employees-legacy-assets.mjs`. |
| 2026-02-13 | 1.0027 | 1.0028 | Codex | pronto-static, pronto-scripts/pronto-root | Modularización real del bundle de empleados: rutas de `router/index.ts` convertidas a lazy imports para code-splitting por vista; `main.js` se redujo de ~82KB a ~20KB y los módulos quedaron en chunks independientes. |
| 2026-02-13 | 1.0028 | 1.0029 | Codex | pronto-tests, pronto-scripts/pronto-root | Endurecimiento anti-smoke en pruebas funcionales: se reemplazaron suites smoke de UI (`menu`, `orders`, `qa-complete`, `qa-cycle`) por flujos reales con login+CSRF+API/capacidades por rol, se eliminaron tests demo (`test_example.py`) y se reforzaron contratos SSR/login en `test_login_flows.spec.ts`. |
| 2026-02-13 | 1.0028 | 1.0029 | Codex | pronto-employees, pronto-docs, pronto-scripts/pronto-root | Corrección de carga cross-origin en SPA empleados: assets SSR cambian a rutas same-origin (`/assets/*`) para usar passthrough interno de employees y eliminar fallos CORS al cargar `main.js` y `chart.umd.min.js`; se registra incidente en error tracker. |
| 2026-02-13 | 1.0029 | 1.0030 | Codex | pronto-client, pronto-docs, pronto-scripts/pronto-root | Restaurado registro de API en `pronto-client` (`api_bp` bajo `/api`) para resolver 404 en `POST /api/call-waiter` en host 6080; validación HTTP confirma `OPTIONS 200` y `POST` deja de responder 404. |
| 2026-02-13 | 1.0030 | 1.0031 | Codex | pronto-static, pronto-docs, pronto-scripts/pronto-root | Hardening de consola employees: supresión de warning espurio en polling realtime ante fallos de red transitorios, normalización de `restaurant_assets` legacy para evitar 404 de logo (`/static/images/...`), y corrección de selectores CSS inválidos (llave huérfana + reglas scrollbar hover incompatibles). |
| 2026-02-14 | 1.0031 | 1.0032 | Codex | pronto-libs, pronto-client, pronto-api, pronto-employees, pronto-docs | Refactor completo de autenticación de clientes: Redis-backed customer_ref (TTL 60m), decorator @require_customer_session, endpoints web auth (/api/login, /api/register, /api/logout, /api/me), proxy orders con header X-PRONTO-CUSTOMER-REF, soporte para kind='kiosk', endpoints de gestión de kiosks, eliminación de client_auth.py legacy. |
| 2026-02-14 | 1.0032 | 1.0033 | Amp | pronto-client, pronto-docs | Fix BUG-20260214-003: /api/me ahora verifica is_revoked() antes de retornar datos. Fix BUG-20260214-004: auth_bp convertido a Blueprint propio, eliminado doble import y alias directo a api_bp. session.clear() añadido en login/logout. |
| 2026-02-14 | 1.0033 | 1.0038 | Amp | pronto-client, pronto-libs | Corrección de 6 bugs de seguridad en autenticación de clientes: BUG-001: notifications.py migrado de JWT a customer_ref/Redis auth + ownership check; BUG-002: Password hashing migrado de SHA256+pepper a PBKDF2 (werkzeug) con auto-rehash; BUG-003: /api/me ahora verifica revocación antes de retornar datos; BUG-004: auth_bp convertido a sub-blueprint propio, eliminado doble import; BUG-005: waiter_calls.py protegido con customer_ref auth guard; BUG-006: split_bills.py protegido con customer_ref auth guard en todos los endpoints. |
| 2026-02-14 | 1.0038 | 1.0039 | Amp | pronto-client | BUG-007: Corregido name shadowing en waiter_calls.py donde `with get_session() as session:` sobreescribía flask.session, causando UnboundLocalError en los auth guards recién agregados. Renombrado a `db_session` en get_waiter_call_status y get_waiter_call_status_alt. |
| 2026-02-15 | 1.0039 | 1.0040 | opencode | docker-compose, pronto-libs, pronto-api, pronto-client, pronto-docs | Corrección de 10 bugs de seguridad: SEC-001: CSRF client (falso positivo); SEC-002: API expuesta (puerto 6082 solo dev); SEC-003: HMAC auth (firma BFF->API); SEC-004: JWT iss/aud validation; SEC-005: JWT key separada; SEC-006: Refresh rotation; SEC-007: PII en JWT (include_pii=False); SEC-008: Redis password required; SEC-009: Rate limiting login; SEC-010: Email logging masking. |
| 2026-02-15 | 1.0040 | 1.0041 | Gemini CLI | pronto-api, pronto-employees, pronto-libs, pronto-static, pronto-docs, pronto-scripts | Auditoría integral y saneamiento: implementados +15 endpoints (branding IA, analytics reales, stats públicas, CRUD promociones, debug flows), corregido hash de agentes, eliminada fuga de estáticos en backend, corregidos falsos positivos de sesión y unificado wrapper HTTP en realtime. |
