Auditoria inconsistencias y UX - 2026-02-03

BLOQUEANTE
N/A

ALTA
N/A

MEDIA
1) pronto-static/src/vue/employees/modules/employee-events.ts:133
Evidencia: fetch(`/api/realtime/notifications?after_id=${this.lastEventId}&limit=50`)
Impacto: polling de eventos falla (404), notificaciones no se actualizan.
Fix minimo: implementar ruta /api/realtime/notifications en pronto-employees (BFF) o ajustar UI al endpoint real existente.

2) pronto-static/src/vue/employees/modules/employee-events.ts:602
Evidencia: fetch('/api/notifications/admin/call')
Impacto: llamadas administrativas no se registran ni notifican.
Fix minimo: agregar endpoint /api/notifications/admin/call en pronto-employees o apuntar al endpoint valido.

3) pronto-static/src/vue/employees/modules/role-context.ts:1-118
Evidencia: RoleKey incluye guest; normaliza system/cook -> admin/chef.
Impacto: roles no canonicos en UI, temas/permisos inconsistentes.
Fix minimo: eliminar aliases y mapear solo roles canonicos; usar system como rol real y normalizar solo a roles canonicos.

4) pronto-static/src/vue/employees/modules/employee-events.ts:177-481
Evidencia: eventos admin_call/waiter_call y allowed roles system/supervisor/staff.
Impacto: notificaciones condicionadas por roles no canonicos.
Fix minimo: alinear tipos de evento y roles con catalogo canonico.

5) pronto-static/src/vue/employees/modules/waiter-board.ts:1660-1760
Evidencia: fetch('/api/notifications/waiter/pending') y fetch(`/api/notifications/waiter/confirm/${callId}`)
Impacto: panel de llamadas no funciona si endpoints no existen en backend de empleados.
Fix minimo: implementar endpoints en pronto-employees o ajustar a rutas existentes.

BAJA
1) pronto-employees/src/pronto_employees/templates/includes/_notifications_panel.html:34
Evidencia: botón "Limpiar" removido
Impacto: boton "Limpiar" no hace nada (404).
Fix minimo: eliminar acción legacy y mantener panel sin limpiar


---
Revisión complementaria 2026-02-03

BLOQUEANTE
N/A

ALTA
N/A

MEDIA
1) pronto-static/src/vue/employees/modules/employee-events.ts:133
Evidencia: fetch(`/api/realtime/notifications?after_id=${this.lastEventId}&limit=50`)
Impacto: polling de eventos falla (404), notificaciones no se actualizan.
Fix minimo: implementar ruta /api/realtime/notifications en pronto-employees (BFF) o ajustar UI al endpoint real existente.

2) pronto-static/src/vue/employees/modules/employee-events.ts:602
Evidencia: fetch('/api/notifications/admin/call')
Impacto: llamadas administrativas no se registran ni notifican.
Fix minimo: agregar endpoint /api/notifications/admin/call en pronto-employees o apuntar al endpoint valido.

3) pronto-static/src/vue/employees/modules/waiter-board.ts:1660-1760
Evidencia: fetch('/api/notifications/waiter/pending') y fetch(`/api/notifications/waiter/confirm/${callId}`)
Impacto: panel de llamadas no funciona si endpoints no existen en backend de empleados.
Fix minimo: implementar endpoints en pronto-employees o ajustar a rutas existentes.

4) pronto-static/src/vue/employees/modules/role-context.ts:1-118
Evidencia: RoleKey incluye guest; normaliza system/cook -> admin/chef.
Impacto: roles no canonicos en UI, temas/permisos inconsistentes.
Fix minimo: eliminar aliases y mapear solo roles canonicos; usar system como rol real y normalizar solo a roles canonicos.

5) pronto-static/src/vue/employees/modules/employee-events.ts:460-481
Evidencia: allowed roles ['system','admin'] y ['system','admin','supervisor']; fallback 'staff'.
Impacto: notificaciones condicionadas por roles no canonicos.
Fix minimo: alinear roles con catalogo canonico.

6) pronto-employees/src/pronto_employees/templates/dashboard.html:4210-4214
Evidencia: option value="supervisor" en selector de rol.
Impacto: permite asignar rol no canonico desde UI.
Fix minimo: eliminar 'supervisor' o reemplazar por rol canonico.

BAJA
1) pronto-employees/src/pronto_employees/templates/includes/_notifications_panel.html:34
Evidencia: botón "Limpiar" removido
Impacto: boton "Limpiar" no hace nada (404).
Fix minimo: eliminar acción legacy y mantener panel sin limpiar

2) pronto-client/src/pronto_clients/routes/api/auth.py:371-385
Evidencia: url = "/static/avatars/{filename}" con static_folder=None en app.
Impacto: avatars no cargan desde static container.
Fix minimo: servir avatars desde pronto-static via assets_images.

---
Revisión 2026-02-03 (corrida 19)

BLOQUEANTE
N/A

ALTA
1) pronto-static/src/vue/employees/modules/kitchen-board.ts
Evidencia: antes fetch('/api/orders/kitchen/pending'); ahora usa fetch('/api/orders?include_closed=true&include_delivered=true') y filtra status=queued.
Impacto: el tablero de cocina carga pendientes sin endpoint especial.
Fix aplicado (2026-02-04): migrado a /api/orders con filtro.

2) pronto-static/src/vue/employees/modules/kitchen-board.ts
Evidencia: antes usaba endpoint legacy de "sesiones pagadas"; ahora deriva “sesiones pagadas” desde /api/orders (workflow_status=paid).
Impacto: cocina muestra pagos sin endpoints /api/sessions/*.
Fix aplicado (2026-02-04): migrado a /api/orders.

3) pronto-static/src/vue/employees/modules/waiter-board.ts
Evidencia: antes usaba endpoint legacy de "sesiones pagadas recientes"; ahora deriva pagos desde /api/orders (workflow_status=paid) y aplica filtro de fecha UI.
Impacto: waiter board muestra pagos sin endpoints /api/sessions/*.
Fix aplicado (2026-02-04): migrado a /api/orders.

4) pronto-static/src/vue/employees/modules/cashier-board.ts
Evidencia: antes usaba endpoint legacy de "sesiones cerradas"; ahora deriva cerradas desde /api/orders (workflow_status in paid,cancelled) y agrupa por session_id.
Impacto: caja muestra cerradas sin endpoints /api/sessions/*.
Fix aplicado (2026-02-04): migrado a /api/orders.

BAJA
N/A
